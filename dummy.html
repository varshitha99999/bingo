<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Bug Bingo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
    <link rel="stylesheet" href="styles.css">


</head>
<body>
     <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Confetti JS -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <script src="script.js"></script>
   <script>
        document.addEventListener("DOMContentLoaded", function () {
            let selectedLanguage = localStorage.getItem("selectedLanguage");
            
            if (!selectedLanguage) {
                alert("No language selected! Redirecting...");
                window.location.href = "front.html";
            } else {
                console.log("Language Selected:", selectedLanguage);
                // Now you can filter questions based on selectedLanguage
            }
        });
    </script>
    <div class="container py-5">
        <div class="row">
            <div class="col-lg-8">
                <!-- Header with BINGO Letters -->
                <div class="game-header text-center">
                    <h1 class="game-title">Python Bug Bingo</h1>
                    <div class="bingo-track" id="bingoProgress">
                        <div class="bingo-letter" style="background-color: #FF6B6B;">B</div>
                        <div class="bingo-letter" style="background-color: #4ECDC4;">I</div>
                        <div class="bingo-letter" style="background-color: #45B7D1;">N</div>
                        <div class="bingo-letter" style="background-color: #A5D8FF;">G</div>
                        <div class="bingo-letter" style="background-color: #FFD8A8;">O</div>
                    </div>
                </div>
                
                <!-- Bingo Grid -->
                <div id="grid"></div>
            </div>
            
            <div class="col-lg-4">
                <!-- Leaderboard -->
                <div class="leaderboard-container">
                    <h3 class="leaderboard-header text-center">Leaderboard</h3>
                    <ul class="leaderboard-list" id="leaderboard">
                        <li class="text-center py-3">Waiting for players...</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Button -->
    <div class="help-btn" data-bs-toggle="modal" data-bs-target="#helpModal">?</div>

    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">How to Play Python Bug Bingo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Game Rules:</h6>
                    <ol>
                        <li>Enter your player name to join the game</li>
                        <li>Click on any bug cell to reveal a Python code snippet with a bug</li>
                        <li>Fix the bug in the code editor and submit your solution</li>
                        <li>If correct, the cell turns green permanently and you earn points</li>
                        <li>Complete a row, column, or diagonal to mark a BINGO letter</li>
                        <li>Complete all 5 letters in BINGO to win!</li>
                        <li>Compete with others on the live leaderboard</li>
                    </ol>
                    <h6 class="mt-3">Scoring:</h6>
                    <ul>
                        <li>Correct bug fix: +10 points</li>
                        <li>Completed BINGO line: +50 points</li>
                        <li>Completed full BINGO: +100 points</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Got it!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Player Name Modal -->
    <div class="modal fade player-modal" id="playerModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Enter Your Name</h5>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="playerName" class="form-label">Choose a name to join the game:</label>
                        <input type="text" class="form-control" id="playerName" placeholder="e.g. PythonPro" maxlength="20">
                        <div class="form-text">This will be displayed on the leaderboard</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="joinGameBtn" type="button" class="btn btn-primary">Join Game</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bugged Code Modal -->
    <div class="modal fade" id="buggedCodeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Fix the Bug</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Bugged Code:</h6>
                    <pre id="buggedCode"></pre>
                    
                    <div class="test-case-info bg-light p-3 rounded mb-3">
                        <div id="testCase"></div>
                        <div id="expectedOutput" class="mt-2"></div>
                    </div>
                    
                    <h6>Your Solution:</h6>
                    <textarea id="userCode" class="form-control mb-3" 
                              placeholder="Enter your corrected code here..." 
                              rows="8" spellcheck="false"></textarea>
                    
                    <div id="testCasesResult"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="submitBtn" type="button" class="btn btn-primary">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Win Celebration Modal -->
    <div class="win-celebration" id="winCelebration">
        <div class="win-text">CONGRATULATIONS!</div>
        <div class="win-subtext">You've fixed all the bugs and won Python Bug Bingo!</div>
        <div class="win-subtext mt-3" id="finalScoreText"></div>
    </div>

   
        // Game state
        const bugDataArray = Object.values(bug_data_python).slice(0, 25);
        let bingoState = {
            rows: new Array(5).fill(0),
            cols: new Array(5).fill(0),
            diagonal1: 0,
            diagonal2: 0
        };
        let completedCells = new Array(5).fill().map(() => new Array(5).fill(false));
        let completedLetters = 0;
        let correctAnswers = new Set();
        
        // Player and leaderboard state
        let player = {
            name: "",
            score: 0,
            completedBugs: 0,
            completedLines: 0,
            hasBingo: false
        };
        
        // Simulated players data
        
        
        let leaderboard = [];

        // Initialize the game
        document.addEventListener('DOMContentLoaded', () => {
            // Show player name modal first
            const playerModal = new bootstrap.Modal(document.getElementById('playerModal'));
            playerModal.show();
            
            // Set up join game button
            document.getElementById('joinGameBtn').addEventListener('click', joinGame);
            
            // Initialize empty leaderboard
            updateLeaderboard();
            
            // Simulate other players joining
            setTimeout(() => {
                leaderboard = [...simulatedPlayers];
                updateLeaderboard();
                
                // Simulate periodic score updates
                
            }, 2000);
        });

        function joinGame() {
            const playerName = document.getElementById('playerName').value.trim();
            if (playerName.length < 2) {
                alert("Please enter a name with at least 2 characters");
                return;
            }
            
            player.name = playerName;
            player.score = 0;
            player.completedBugs = 0;
            player.completedLines = 0;
            player.hasBingo = false;
            
            // Add player to leaderboard
            leaderboard.push({...player});
            
            // Close modal and start game
            const playerModal = bootstrap.Modal.getInstance(document.getElementById('playerModal'));
            playerModal.hide();
            
            createGrid();
            updateLeaderboard();
        }

        function createGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 5; i++) {
                for (let j = 0; j < 5; j++) {
                    const index = i * 5 + j;
                    const cell = document.createElement('div');
                    cell.className = 'bug-cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.dataset.index = index;
                    cell.innerHTML = '🐛';
                    
                    cell.addEventListener('click', function() {
                        const clickedIndex = parseInt(this.dataset.index);
                        if (!correctAnswers.has(clickedIndex)) {
                            openModal(i, j, clickedIndex);
                        }
                    });
                    
                    grid.appendChild(cell);
                }
            }
        }

        function openModal(row, col, index) {
            const bugData = bugDataArray[index];
            
            if (!bugData) {
                console.error('No bug data found for index:', index);
                return;
            }
            
            document.getElementById('buggedCode').textContent = bugData.code;
            document.getElementById('testCase').textContent = `Test Case: ${bugData.test_case}`;
            document.getElementById('expectedOutput').textContent = `Expected Output: ${bugData.expected_output}`;
            document.getElementById('userCode').value = '';
            document.getElementById('testCasesResult').innerHTML = '';
            
            document.getElementById('submitBtn').onclick = function() {
                submitSolution(row, col, index, bugData);
            };
            
            const modal = new bootstrap.Modal(document.getElementById('buggedCodeModal'));
            modal.show();
        }

        function submitSolution(row, col, index, bugData) {
            const userCode = document.getElementById('userCode').value.trim();
            const isCorrect = userCode.length > 0 && userCode !== bugData.code;
            
            if (isCorrect) {
                // Mark as permanently correct
                correctAnswers.add(index);
                completedCells[row][col] = true;
                
                // Update cell appearance
                const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                cell.classList.add('correct');
                cell.innerHTML = '✅';
                
                // Update player score and stats
                player.score += 10;
                player.completedBugs++;
                
                // Update Bingo state
                bingoState.rows[row]++;
                bingoState.cols[col]++;
                if (row === col) bingoState.diagonal1++;
                if (row + col === 4) bingoState.diagonal2++;
                
                // Update leaderboard
                updatePlayerInLeaderboard();
                updateLeaderboard();
                
                // Trigger confetti
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
                
                // Check for completed lines
                checkBingo();
                
                // Show success message
                document.getElementById('testCasesResult').innerHTML = `
                    <div class="alert alert-success d-flex align-items-center">
                        ✅ Correct! +10 points!
                    </div>
                `;
                
                // Close modal after delay
                setTimeout(() => {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('buggedCodeModal'));
                    modal.hide();
                }, 1500);
            } else {
                document.getElementById('testCasesResult').innerHTML = `
                    <div class="alert alert-danger d-flex align-items-center">
                        ❌ Incorrect, try again!
                    </div>
                `;
            }
        }

        function checkBingo() {
            // Check rows
            for (let i = 0; i < 5; i++) {
                if (bingoState.rows[i] === 5 && completedLetters < 5) {
                    completeBingoLetter();
                    bingoState.rows[i] = 0; // Reset to prevent multiple triggers
                    return;
                }
            }
            
            // Check columns
            for (let j = 0; j < 5; j++) {
                if (bingoState.cols[j] === 5 && completedLetters < 5) {
                    completeBingoLetter();
                    bingoState.cols[j] = 0; // Reset
                    return;
                }
            }
            
            // Check diagonals
            if (bingoState.diagonal1 === 5 && completedLetters < 5) {
                completeBingoLetter();
                bingoState.diagonal1 = 0; // Reset
                return;
            }
            
            if (bingoState.diagonal2 === 5 && completedLetters < 5) {
                completeBingoLetter();
                bingoState.diagonal2 = 0; // Reset
                return;
            }
        }

        function completeBingoLetter() {
            if (completedLetters < 5) {
                const letters = document.querySelectorAll('.bingo-letter');
                letters[completedLetters].classList.add('completed');
                
                // Update player score and stats
                player.score += 50;
                player.completedLines++;
                
                // Update leaderboard
                updatePlayerInLeaderboard();
                updateLeaderboard();
                
                // Big confetti for letter completion
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 }
                });
                
                completedLetters++;
                
                // Check for full BINGO
                if (completedLetters === 5) {
                    player.score += 100;
                    player.hasBingo = true;
                    updatePlayerInLeaderboard();
                    updateLeaderboard();
                    setTimeout(showWinCelebration, 1000);
                }
            }
        }

        function showWinCelebration() {
            const celebration = document.getElementById('winCelebration');
            const finalScoreText = document.getElementById('finalScoreText');
            finalScoreText.textContent = `Final Score: ${player.score} points`;
            celebration.classList.add('active');
            
            // Mega confetti blast
            confetti({
                particleCount: 500,
                spread: 120,
                origin: { y: 0.6 }
            });
        }
        
        function updatePlayerInLeaderboard() {
            // Find player in leaderboard
            const playerIndex = leaderboard.findIndex(p => p.name === player.name);
            if (playerIndex !== -1) {
                leaderboard[playerIndex] = {...player};
            }
            
            // Sort leaderboard by score
            leaderboard.sort((a, b) => b.score - a.score);
        }
        
        function updateLeaderboard() {
            const leaderboardElement = document.getElementById('leaderboard');
            leaderboardElement.innerHTML = '';
            
            if (leaderboard.length === 0) {
                leaderboardElement.innerHTML = '<li class="text-center py-3">Be the first to join!</li>';
                return;
            }
            
            // Find max score for progress bars
            const maxScore = Math.max(...leaderboard.map(p => p.score), 100);
            
            leaderboard.forEach((playerData, index) => {
                const isCurrentPlayer = playerData.name === player.name;
                const li = document.createElement('li');
                li.className = `leaderboard-item ${isCurrentPlayer ? 'me' : ''}`;
                
                li.innerHTML = `
                    <div class="leaderboard-rank">${index + 1}</div>
                    <div class="leaderboard-name">
                        ${playerData.name}
                        ${playerData.hasBingo ? '🏆' : ''}
                        <div class="leaderboard-progress">
                            <div class="leaderboard-progress-bar" style="width: ${(playerData.score / maxScore) * 100}%"></div>
                        </div>
                    </div>
                    <div class="leaderboard-score">${playerData.score}</div>
                `;
                
                leaderboardElement.appendChild(li);
            });
        }
    </script>
</body>
</html>
